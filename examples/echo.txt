### Set up interrupt vectors
loadwi 15 0

# first vector
strapr 15 .intr_vec

# Point to next vector
addi 15 1 15

# Remaining vectors
.write_vector
strapr 15 .exit
addi 15 1 15
jmpgei 15 10 .write_done  # 16 vectors
jmp .write_vector  # Next vector

.write_done

eni  # Reenable interrupts

# Set up interrupt controller
savewi 40 FFFFFED2
savewi .keyboard_intr FFFFFED6
savebi 1 FFFFFEDA
savewi 0 FFFFFECE

# Set up keyboard
savewi 1 FFFFFEC1

# Main loop
.loop

# Wait for interrupt
wait

# Check flag
jmpeqi A 1 .exit

# And back around
jmp .loop

# Keyboard interrupt
.keyboard_intr

# Read keystroke
loadw B FFFFFEC5

# Print it if nonzero
jmpeqi B 0 .return
saveb B FFFFFEFF

# Is the keystroke a tilde?
jmpnei B 7E .return

# It is, so set the flag to exit
loadwi A 1

# Return
.return
# Reenable interrupts
savewi 0 FFFFFECE 0
ret

# End program
.exit
halt


# Interrupt vectors
.intr_vec
jmp FFFFFEEA
